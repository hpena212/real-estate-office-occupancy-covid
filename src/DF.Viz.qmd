---
title: "Datafest25'"
format: pdf
editor: visual
---

```{r}
#leases1 <- read.csv("C:/Users/STSC/Downloads/Datafest 25/leases_and_Availability_Data.csv")
leases <- read.csv("C:/Users/STSC/Downloads/Datafest 25/Leases.csv")
occupancy <- read.csv("C:/Users/STSC/Downloads/Datafest 25/Major_Market_occupancy_Data.csv")
merge <- read.csv("C:/Users/STSC/Downloads/Datafest 25/Lease.merge.csv")
```

```{r}
library(ggplot2)
library(dplyr)

ggplot(occupancy, aes(x = interaction(year, quarter), y = avg_occupancy_proportion, color = market, group = market)) +
  geom_line(size = 1) +
  geom_point() +
  labs(title = "Average occupancy2 Over Time by Market",
       x = "Quarter",
       y = "Avg occupancy2 (% of March 1, 2020 level)",
       color = "Market") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

This helps show how average occupancy2 changed from 2020 to 2024 for each market.

Use `interaction(year, quarter)` to get one x-axis label per quarter. For fancier output, you could create a `quarter_label` column like `"2020 Q1"`.

```{r}
library(ggplot2)
library(viridis)

occupancy2 <- occupancy %>%  mutate(quarter_label = paste(year,quarter))

occupancy2 %>%
ggplot(aes(x = quarter_label, y = market, fill = avg_occupancy_proportion)) +
  geom_tile(color = "white") +
  scale_fill_gradientn(
    colors = c("white", "yellow", "orange", "red", "purple"),
    name = "Avg Occupancy"
  ) +
  labs(title = "Heatmap of Average Occupancy by Market and Quarter",
       x = "Quarter", y = "Market") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Showing dips and spikes per quarter for each market

```{r}
occupancy2 %>%
  filter(market == "San Francisco", year >= 2020) %>%
  ggplot(aes(x = quarter_label)) +
  geom_line(aes(y = avg_occupancy_proportion), group = 1, color = "darkred", size = 1.2) +
  geom_point(aes(y = avg_occupancy_proportion), size = 2) +
  labs(title = "San Francisco Avg occupancy2 Since Pandemic",
       x = "Quarter", y = "Avg occupancy2") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
occupancy2 %>%
  filter(market == "Los Angeles", year >= 2020) %>%
  mutate(quarter_label = paste(year, paste0("Q", quarter))) %>%
  ggplot(aes(x = quarter_label)) +
  geom_line(aes(y = avg_occupancy_proportion), group = 1, color = "green", size = 1.2) +
  geom_point(aes(y = avg_occupancy_proportion), size = 2) +
  labs(title = "Los Angeles Avg occupancy Since Pandemic",
       x = "Quarter", y = "Avg occupancy") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Average occupancy2 in San Fransisco during and after the pandemic

```{r}
occupancy2 %>%
  filter(year == 2024) %>%
  group_by(market) %>%
  summarise(mean_occupancy = mean(avg_occupancy_proportion, na.rm = TRUE)) %>%
  ggplot(aes(x = reorder(market, mean_occupancy), y = mean_occupancy)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(title = "Mean occupancy2 in 2024 by Market",
       x = "Market", y = "Avg occupancy2 (%)") +
  theme_minimal()

```

occupancy2 in 2024, from this we can see that in the South Bay, Philadelphia, and San Francisco, occupancy2 is still low, showing evidence in those places

# San Francisco

```{r}
sf_occ <- occupancy2 %>%
  filter(market == "San Francisco") %>%
  mutate(quarter_label = paste(year, paste0("Q", quarter)))


```

```{r}
library(tidyverse)
sf_occ_long <- sf_occ %>%
  pivot_longer(cols = c(starting_occupancy_proportion, ending_occupancy_proportion),
               names_to = "type", values_to = "occupancy2")

ggplot(sf_occ_long, aes(x = quarter_label, y = occupancy2, color = type, group = type)) +
  geom_line(size = 1.2) +
  geom_point() +
  labs(title = "San Francisco: Start vs End occupancy2 by Quarter",
       x = "Quarter", y = "occupancy Proportion",
       color = "Time Point") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

```{r}
sf_occ %>%
  slice_max(avg_occupancy_proportion, n = 3)

sf_occ %>%
  slice_min(avg_occupancy_proportion, n = 3)


```

Best and worst Quarters and Year for San Fransisco

Sharing desks.... .5 - .6

try to do by industry

# Q: Is space sitting empty? Is rent dropping? Are landlords offering deals?

Filtering data for San Fransisco and between years 2018 and 2024

```{r}
sf_leases <- leases %>%
  filter(market == "San Francisco",
         year >= 2018 & year <= 2024) %>%
  mutate(quarter_label = paste(year, paste0("Q", quarter)))

```

```{r}
ggplot(sf_leases, aes(x = quarter_label, y = internal_class_rent, color = internal_class, group = internal_class)) +
  geom_line(size = 1.2) +
  labs(title = "Rent Trends by Building Class (San Francisco)",
       y = "Average Rent ($/sqft)", x = "Quarter", color = "Class") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
ggplot(sf_leases, aes(x = quarter_label, y = availability_proportion, color = internal_class, group = internal_class)) +
  geom_line(size = 1.2) +
  labs(title = "Availability Proportion Over Time",
       y = "Proportion Available", x = "Quarter", color = "Class") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

We can see in 2018-19 there was a low amount of buildings available to be leased in San Fransisco, however, starting 2020, due to COVID we can see a spike in the proportion of available spaces.

```{r}
sf_leases %>%
  ggplot(aes(x = quarter_label)) +
  geom_line(aes(y = available_space/1000, color = "Available Space"), size = 1.2) +
  geom_line(aes(y = leasing/1000, color = "Leased Space"), size = 1.2) +
  labs(title = "Supply vs Leasing Activity",
       y = "Square Feet (in thousands)", x = "Quarter", color = "Metric") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1.5))

```

Did this trend follow other cities in california?

# Los Angeles

```{r}
la_leases <- leases %>%
  filter(market == "Los Angeles",
         year >= 2018 & year <= 2024) %>%
  mutate(quarter_label = paste(year, paste0("Q", quarter)))

```

```{r}
ggplot(la_leases, aes(x = quarter_label, y = internal_class_rent, color = internal_class, group = internal_class)) +
  geom_line(size = 1.2) +
  labs(title = "Rent Trends by Building Class (Los Angeles)",
       y = "Average Rent ($/sqft)", x = "Quarter", color = "Class") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
ggplot(la_leases, aes(x = quarter_label, y = availability_proportion, color = internal_class, group = internal_class)) +
  geom_line(size = 1.2) +
  labs(title = "Availability Proportion Over Time",
       y = "Proportion Available", x = "Quarter", color = "Class") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
  ggplot(la_leases, aes(x = quarter_label)) +
  geom_line(aes(y = available_space, color = "Available Space"), size = 1.2) +
  geom_line(aes(y = leasing, color = "Leased Space"), size = 1.2) +
  labs(title = "Supply vs Leasing Activity",
       y = "Square Feet", x = "Quarter", color = "Metric") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

# Cali Markets

```{r}

cali <- leases %>%
  filter(
    market %in% c("San Francisco", "Los Angeles", "San Diego"),
    year >= 2018 & year <= 2024
  ) %>%
  mutate(quarter_label = paste(year, quarter))

```

```{r}
ggplot(cali, aes(x = quarter_label, y = leasedSF/1000, color = market, group = market)) +
  geom_line(size = 1.1) +
  geom_point() +
  labs(
    title = "Quarterly Leased Square Footage by Market (2018–2024)",
    x = "Quarter",
    y = "Total Square Feet (in thousands)",
    color = "Market"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
ggplot(cali, aes(x = quarter_label, y = available_space/1000, color = market, group = market)) +
  geom_line(size = 1.1) +
  geom_smooth() +
  labs(
    title = "Quarterly Leased Square Footage by Market (2018–2024)",
    x = "Quarter",
    y = "Total Square Feet (in thousands)",
    color = "Market"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Leasing Trends over time

```{r}
ggplot(cali, aes(x = quarter_label, y = leasedSF/1000, color = market, group = market)) +
  geom_line(size = 1.2) +
  labs(title = "Leased SF Over Time by Market", x = "Quarter", y = "Leased SF") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
library(tidyr)
library(ggplot2)
library(dplyr)

# Pivot only 'available_space' column
cali_long <- cali %>%
  pivot_longer(cols = available_space, 
               names_to = "metric", 
               values_to = "value")

# Plot the single-metric faceted line chart (only one facet in this case)
ggplot(cali_long, aes(x = quarter_label, y = value, color = market, group = market)) +
  geom_line(size = 1) +
  facet_wrap(~ metric, scales = "free_y") +
  labs(title = "Available Space Over Time by Market", x = "Quarter", y = "Sq Ft") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

```{r}
ggplot(cali, aes(x = quarter_label, y = available_space, color = market)) +
  geom_line(alpha = 1.5) +
  geom_smooth(se = FALSE, method = "loess") +
  labs(title = "Smoothed Occupancy Rate Trends", y = "Average Occupancy", x = "Quarter") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
ggplot(cali, aes(x = quarter_label, y = market, fill = leasing)) +
  geom_tile() +
  scale_fill_viridis_c() +
  labs(title = "Heatmap of Leasing Activity by Market and Quarter", x = "Quarter", y = "Market") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

## **Time Trends for Leasing and Available Space**

Track market behavior across quarters.

## Available Space vs Leasing Scatterplot

dyanmic plots - change over time

### Available Space by Market or Class

```{r}
ggplot(cali, aes(x = market, y = available_space, fill = market)) +
  geom_boxplot() +
  labs(title = "Available Space by Market", x = "Market", y = "Available Space (sq ft)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Face wrap by year

### Leasing by Market

```{r}
library(dplyr)

cali %>%
  group_by(market) %>%
  summarise(total_leasing = sum(leasing, na.rm = TRUE)) %>%
  ggplot(aes(x = reorder(market, -total_leasing), y = total_leasing, fill = market)) +
  geom_col() +
  labs(title = "Total Leasing Activity by Market", y = "Total Leasing", x = "Market") +
  theme_minimal()

```

```{r}

#cali2 <- merge %>%
 #filter(
    #market %in% c("San Francisco", "Los Angeles"),
    #year >= 2018 & year <= 2024
  #) %>%
  #mutate(quarter_label = paste(year, quarter))


library(dplyr)

merge2 <- merge %>%  mutate(quarter_label = paste(year,quarter))
  


cali3 <- merge %>%
  filter(
    market %in% c("Los Angeles", "San Francisco", "South Bay/San Jose"),
    !is.na(avg_occupancy_proportion),
    !is.na(leasedSF)
  ) %>%
  mutate(quarter_label = paste(year,quarter))

cali4 <- merge %>%
  filter(
    market %in% c("Los Angeles", "San Francisco", "Manhattan", "Houston", "Dallas", "Detroit", "Austin")) %>%
  mutate(quarter_label = paste(year,quarter))
```

## Occupancy vs Unemployment

```{r}
ggplot(cali3, aes(x = unemployment_rate, y = avg_occupancy_proportion, color = market)) +
  geom_point() +
  labs(title = "Occupancy vs Unemployment Rate", x = "Unemployment Rate", y = "Avg Occupancy") +
  theme_minimal()

```

```{r}
ggplot(cali3, aes(x = space_type, y = leasedSF, fill = internal_class)) +
  geom_boxplot() +
  facet_wrap(~ market) +
  labs(title = "Leased SF by Class and Space Type", x = "Space Type", y = "Leased SF") +
  theme_minimal()
```

```{r}
library(ggplot2)
library(scales)

ggplot(cali3, aes(x = quarter_label, y = avg_occupancy_proportion, color = market, group = market)) +
  geom_line(size = 0.5) +
  geom_point(size = 3, alpha = 0.8) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  labs(
    title = "Average Office Occupancy Proportion Over Time",
    subtitle = "Based on Kastle card swipe data (% of pre-pandemic baseline)",
    x = "Quarter",
    y = "Average Occupancy Rate",
    color = "Market"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold", size = 18),
    plot.subtitle = element_text(size = 13, color = "gray40"),
    legend.position = "top",
    panel.grid.minor = element_blank()
  )




```

Predictor models

```{r}
ggplot(cali4, aes(x = quarter_label, y = direct_available_space, color = market, group = market)) +
  geom_smooth(size = 1.2, SE = FALSE) +
  labs(title = "Proportion of Available Spaces by Market", x = "Quarter", y = "Overall Rent", color = "Market") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
ggplot(cali4, aes(x = quarter_label, y = overall_rent, color = market, group = market)) +
  geom_line(size = 1.5) +
  geom_vline(xintercept = which(levels(factor(cali4$quarter_label)) == "2020 Q2"), 
             linetype = "dashed", color = "black", size = 1) +
  labs(title = "Pre & Post COVID Average Rent Prices",
       x = "Quarter", y = "Average Rent (thousands)", color = "Markets") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

```{r}
ggplot(cali4, aes(x = market, y = overall_rent, fill = market)) +
  geom_boxplot() +
  labs(title = "Variability in Overall Rent by Market", y = "Overall Rent") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
boxplot(overall_rent ~ market, data = cali4, las = 2,
        col = rainbow(length(unique(cali4$market))),
        main = "Overall Rent Variability by Market",
        ylab = "Overall Rent")

```

```{r}
ggplot(cali4, aes(x = quarter_label, y = overall_rent, color = region, group = region)) +
  geom_line(size = 1.2) +
  labs(title = "Seasonal Rent Trends by Region", x = "Quarter", y = "Overall Rent") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
boxplot(internal_class_rent ~ transaction_type, data = cali4,
        col = "lightblue",
        main = "Rent by Transaction Type",
        ylab = "Class Rent", las = 2)




```

```{r}
stripchart(sublet_available_space ~ region, data = cali4, method = "jitter",
           vertical = TRUE, pch = 16, col = rainbow(length(unique(cali4$region))),
           main = "Sublet Space by Region", ylab = "Sublet Available Space")

```
